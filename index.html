<script type="module">
  import * as pdfjsLib from "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.5.136/build/pdf.mjs";

  // ✅ Use real module worker
  pdfjsLib.GlobalWorkerOptions.workerPort = new Worker(
    "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.5.136/build/pdf.worker.mjs",
    { type: "module" }
  );

  // ✅ Then all your JavaScript remains unchanged
  const $ = (id) => document.getElementById(id);
  const msg = $("msg");
  const downloads = $("downloads");
  const chargeNameInput = $("chargeName");
  chargeNameInput.value = localStorage.getItem("mh_charge_name") || "Water Billing";
  $("year").textContent = new Date().getFullYear();

  const currency = (n) => n.toLocaleString(undefined, { style: "currency", currency: "USD" });

  const parseUsDate = (s) => {
    const m1 = s.match(/\b(\d{1,2})\/(\d{1,2})\/(\d{2,4})\b/);
    if (m1) {
      const y = Number(m1[3].length === 2 ? (Number(m1[3]) + 2000) : m1[3]);
      const d = Number(m1[2]);
      const mo = Number(m1[1]) - 1;
      const dt = new Date(y, mo, d);
      return isNaN(dt.getTime()) ? undefined : dt;
    }
    const m2 = s.match(/\b(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Sept|Oct|Nov|Dec)[a-z]*\s+\d{1,2},\s*\d{4}\b/i);
    if (m2) return new Date(m2[0]);
    return undefined;
  };

  const toStartOfNextMonth = (d) => {
    const base = d || new Date();
    return new Date(base.getFullYear(), base.getMonth() + 1, 1);
  };

  const fileToArrayBuffer = (f) => new Promise((res, rej) => {
    const r = new FileReader();
    r.onload = () => res(r.result);
    r.onerror = rej;
    r.readAsArrayBuffer(f);
  });

  const fileToText = (f) => new Promise((res, rej) => {
    const r = new FileReader();
    r.onload = () => res(r.result);
    r.onerror = rej;
    r.readAsText(f);
  });

  const normalizeMoney = (s) => Number(String(s).replace(/[^\d.-]/g, "")) || 0;

  // ... ALL YOUR REMAINING CODE IS UNCHANGED ...
</script>

